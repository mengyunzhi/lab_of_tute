'use strict';

var app = angular.module('app', ['ui.router']);
app.config(function ($stateProvider) {
  $stateProvider.state('main', {
    url: '',
    templateUrl: '/themes/yunzhiclub/assets/main.html'
  }).state('add', {
    url: '/add',
    templateUrl: '/themes/yunzhiclub/assets/add.html',
    controller: 'AddCtrl',
    data: {
      title: '添加授课计划'
    }
  }).state('data', {
    url: '/data',
    templateUrl: 'data/index.html',
    controller: 'DataIndexCtrl',
    data: {
      title: '系统设置 - 数据管理'
    }
  });
});
'use strict';

app.controller('AddCtrl', ['scheduleService', '$scope', function (scheduleService, $scope) {
  var self = this;
  $scope.isOpen = true;
  self.states = {
    unSubmit: 'unSubmit',
    submitting: 'submitting',
    submitted: 'submitted'
  };

  self.init = function () {
    self.initData();
  };

  self.initData = function () {
    $scope.state = self.states.unSubmit;
    $scope.data = {
      name: '',
      lab: '',
      course: '',
      klasses: '',
      time: ''
    };
  };

  self.showByState = function (state) {
    if (state === $scope.state) {
      return true;
    } else {
      return false;
    }
  };

  self.submit = function () {
    $scope.state = self.states.submitting;
    scheduleService.save($scope.data).then(function success() {
      $scope.state = self.states.submitted;
    }, function error(response) {
      alert('发生错误:' + response.state);
      $scope.state = self.states.submitted;
    });
  };

  self.init();
  $scope.initData = self.initData;
  $scope.showByState = self.showByState;
  $scope.submit = self.submit;
}]);

'use strict';

app.service('scheduleService', ['$http', function ($http) {
  var self = this;

  self.save = function (data) {
    var headers = {
      'X-OCTOBER-REQUEST-HANDLER': 'onSaveSubmit',
      'X-Requested-With': 'XMLHttpRequest'
    };
    return $http.post('', data, {
      headers: headers
    });
  };

  return {
    save: self.save
  };
}]);